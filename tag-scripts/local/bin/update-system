#!/usr/bin/env bash
set -euo pipefail

printf "Updating sources...\n\t"
sudo apt -qq update

printf "Ugrading packages...\n\t"
sudo apt -qq -y dist-upgrade

printf "Removing unneeded packages...\n\t"
sudo apt -qq -y autoremove

# update dotfiles before applying them
pushd $DOTFILES
git fetch --all && git pull && pit push
popd

export RCRC=~/.dotfiles/config/rcrc
rcup -v

nvim -c PlugUpgrade -c PlugClean -c PlugUpdate -c quitall

# push password repo
pass git push || true

# tmux plugins
TPM_BIN="$HOME/.tmux/plugins/tpm/bin"
$TPM_BIN/clean_plugins
$TPM_BIN/install_plugins
$TPM_BIN/update_plugins all

"$HOME/.local/bin/tarsnap-backup" || true # some firewalls block access
