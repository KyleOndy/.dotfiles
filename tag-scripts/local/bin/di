#!/usr/bin/env bash
set -euo pipefail

interval=${1:-"daily"}

diary_dir="$HOME/.diary"
mkdir -p "$diary_dir"

_make_entry() {
  template=$1
  file_name=$2
  header=$3

  cp --no-clobber "$diary_dir/template.$template" "$file_name"
  sed -i "s|{{date}}|$header|" "$file_name"

}

case "$interval" in
  d|daily)
    today_file="$diary_dir/$(date +%Y-%m-%d-%A).md"
    header=$(date '+%A, %B %d, %Y')

    _make_entry "daily" "$today_file" "$header"
    $EDITOR "$today_file"
    ;;
  w|weekly)
    week_file="$diary_dir/$(date +%Yw%V).md"
    header=$(date '+%Y, week %V')

    _make_entry "weekly" "$week_file" "$header"
    $EDITOR "$week_file"
    ;;
  m|monthly)
    month_file="$diary_dir/$(date +%Ym%m)"
    header=$(date '+%B, %Y')

    _make_entry "monthly" "$month_file" "$header"
    $EDITOR "$month_file"
    ;;
  *)
    echo "Argument must be none (d|daily), 'w|weekly', or 'm|montly'."
    exit 1
esac

